<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>A W O - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø©</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { 
            --gold: #ffcc00; 
            --table-green: radial-gradient(circle, #1a5d1a 0%, #0a2b0a 100%);
            --card-w: 72px;
            --card-h: 108px;
            --blue-glow: 0 0 15px #00e5ff;
            --purple-glow: 0 0 15px #d500f9;
            --orange-glow: 0 0 15px #ff6d00;
        }
        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Cairo', sans-serif; background: #000; color: white; overflow: hidden; }
        
        #splash { position: fixed; inset: 0; background: radial-gradient(circle, #222 0%, #000 100%); z-index: 1000; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .logo { font-size: 6rem; font-weight: 900; color: var(--gold); letter-spacing: 20px; text-shadow: 0 0 30px rgba(255,204,0,0.5); }

        .game-ui { display: none; height: 100vh; background: var(--table-green); position: relative; border: 15px solid #2d1b18; box-sizing: border-box; }
        .game-ui::after { content: ''; position: absolute; inset: 0; border: 2px solid rgba(255,255,255,0.1); pointer-events: none; }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØµØ¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ø¯Ø«Ø© */
        #leaderboard { position: absolute; top: 20px; left: 20px; background: rgba(0,0,0,0.8); border-left: 4px solid var(--gold); border-radius: 4px 12px 12px 4px; padding: 15px; width: 180px; z-index: 50; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .leader-header { color: var(--gold); font-weight: 900; text-align: center; border-bottom: 1px solid #444; margin-bottom: 10px; padding-bottom: 5px; }

        /* Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙˆØªÙØ§Ø¹Ù„Ø§Øª Ø§Ù„Ø£Ø¯ÙˆØ§Ø± */
        .profile { position: absolute; display: flex; flex-direction: column; align-items: center; width: 110px; transition: 0.4s; }
        .avatar { width: 75px; height: 75px; border-radius: 50%; border: 4px solid #444; background: #111; position: relative; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .active-turn .avatar { border-color: var(--gold); box-shadow: 0 0 25px var(--gold); transform: scale(1.15); }
        .p-name { margin-top: 8px; font-weight: bold; font-size: 14px; text-shadow: 0 2px 4px #000; }

        .pos-0 { bottom: 210px; left: 50%; transform: translateX(-50%); } 
        .pos-1 { top: 40px; left: 50%; transform: translateX(-50%); }    
        .pos-2 { top: 45%; left: 60px; transform: translateY(-50%); }   
        .pos-3 { top: 45%; right: 60px; transform: translateY(-50%); }  

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙˆØ³Ø· ÙˆØ§Ù„Ø²Ø¨Ø§Ù„Ø© */
        .center-deck { position: absolute; top: 48%; left: 50%; transform: translate(-50%, -50%); display: flex; gap: 50px; }
        .deck-box { width: 85px; height: 120px; border-radius: 10px; background: rgba(0,0,0,0.3); border: 2px solid rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.3s; position: relative; }
        .deck-box:hover { border-color: var(--gold); background: rgba(0,0,0,0.5); transform: translateY(-5px); }
        .deck-label { position: absolute; bottom: -25px; font-size: 12px; color: rgba(255,255,255,0.6); }

        /* Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ ÙˆØ§Ù„ÙØ±Ø² Ø§Ù„Ø°ÙƒÙŠ */
        .hand-area { 
            position: absolute; bottom: 30px; left: 50px; right: 180px; 
            display: flex; justify-content: center; align-items: flex-end; height: 160px;
        }
        
        .card { 
            width: var(--card-w); height: var(--card-h); background: #fff; border-radius: 8px; color: #000; 
            padding: 6px; cursor: grab; display: flex; flex-direction: column; justify-content: space-between; 
            box-shadow: 2px 5px 10px rgba(0,0,0,0.3); border: 1px solid #ccc; position: relative;
            margin-left: -35px; transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1); flex-shrink: 0;
        }
        .card:hover { transform: translateY(-35px) scale(1.1); z-index: 500 !important; box-shadow: 0 15px 30px rgba(0,0,0,0.5); }
        .card.dragging { opacity: 0; }
        .card.red { color: #e53935; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù…Ø·ÙˆØ± */
        .card-strip { position: absolute; top: 0; right: 0; bottom: 0; width: 6px; display: none; border-radius: 0 8px 8px 0; }
        .strip-blue { display: block; background: #00e5ff; box-shadow: -2px 0 10px #00e5ff; }
        .strip-purple { display: block; background: #d500f9; box-shadow: -2px 0 10px #d500f9; }
        .strip-orange { display: block; background: #ff6d00; box-shadow: -2px 0 10px #ff6d00; }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
        .side-btns { position: absolute; bottom: 40px; right: 30px; display: flex; flex-direction: column; gap: 15px; z-index: 1000; }
        .btn-awo { 
            width: 130px; height: 45px; border-radius: 8px; border: none; font-weight: 900; 
            cursor: pointer; font-family: 'Cairo'; transition: 0.3s;
            text-transform: uppercase; letter-spacing: 1px;
        }
        .btn-main { background: var(--gold); color: #000; box-shadow: 0 4px 0 #b89200; }
        .btn-win { background: #2ecc71; color: #fff; box-shadow: 0 4px 0 #1e8449; }
        .btn-awo:hover { transform: translateY(-2px); filter: brightness(1.1); }
        .btn-awo:active { transform: translateY(2px); box-shadow: none; }

        .status-msg { position: absolute; top: 130px; width: 100%; text-align: center; color: var(--gold); font-weight: 900; font-size: 1.4rem; text-shadow: 0 0 10px rgba(0,0,0,1); }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø±Ø¨Ø­ */
        @keyframes winPulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .winner-glow { animation: winPulse 0.5s infinite; border-color: #2ecc71 !important; box-shadow: 0 0 30px #2ecc71 !important; }
    </style>
</head>
<body>

<div id="splash">
    <div class="logo">A W O</div>
    <div style="color:rgba(255,255,255,0.5); margin-bottom: 20px;">Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© v2.0</div>
    <button onclick="startGame()" style="padding: 18px 60px; border-radius: 12px; border:none; background:var(--gold); font-weight:900; cursor:pointer; font-family:'Cairo'; font-size:1.3rem; box-shadow: 0 0 20px rgba(255,204,0,0.3);">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ø¯ÙŠ</button>
</div>

<div class="game-ui" id="ui">
    <div id="leaderboard">
        <div class="leader-header">ØµØ¯Ø§Ø±Ø© A W O</div>
        <div id="leader-list"></div>
    </div>

    <div class="status-msg" id="status">Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø·Ø§ÙˆÙ„Ø©...</div>

    <div class="profile pos-0" id="prof-0"><div class="avatar"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Player" width="100%"></div><div class="p-name">Ø£Ù†Øª</div></div>
    <div class="profile pos-1" id="prof-1"><div class="avatar"><img src="https://api.dicebear.com/7.x/bottts/svg?seed=Bot1" width="100%"></div><div class="p-name">Ø§Ù„Ø£Ø³Ø·ÙˆØ±Ø©</div></div>
    <div class="profile pos-2" id="prof-2"><div class="avatar"><img src="https://api.dicebear.com/7.x/bottts/svg?seed=Bot2" width="100%"></div><div class="p-name">Ø§Ù„Ù…Ø­ØªØ±Ù</div></div>
    <div class="profile pos-3" id="prof-3"><div class="avatar"><img src="https://api.dicebear.com/7.x/bottts/svg?seed=Bot3" width="100%"></div><div class="p-name">Ø§Ù„Ù…Ø®Ø¶Ø±Ù…</div></div>

    <div class="center-deck">
        <div class="deck-box" style="border: 2px solid var(--gold);" onclick="processAction('draw')">
            <span style="font-size:2rem">ğŸ“¦</span>
            <div class="deck-label">Ø³Ø­Ø¨ ÙˆØ±Ù‚</div>
        </div>
        <div id="discard-pile" class="deck-box" onclick="processAction('pick')">
            <span style="opacity:0.3">Ø§Ù„Ø²Ø¨Ø§Ù„Ø©</span>
            <div class="deck-label">Ø§Ù„ÙˆØ±Ù‚ Ø§Ù„Ù…Ø±Ù…ÙŠ</div>
        </div>
    </div>

    <div class="hand-area" id="hand"></div>

    <div class="side-btns">
        <button class="btn-awo btn-win" onclick="handleWin()">Ù†Ø²ÙˆÙ„ (Ù‡Ù†Ø¯!)</button>
        <button class="btn-awo btn-main" onclick="autoOrganize()">ØªØ±ØªÙŠØ¨ ØªÙ„Ù‚Ø§Ø¦ÙŠ</button>
    </div>
</div>

<script>
    // --- Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠ (Ø¯ÙˆÙ† Ø­Ø°Ù Ø£ÙŠ Ù…Ù†Ø·Ù‚ Ø³Ø§Ø¨Ù‚) ---
    const suits = ['â™ ', 'â™¥', 'â™¦', 'â™£'], vals = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
    let playerHand = [], discardPile = [], turn = 0, state = "DRAW";
    let draggedIdx = null;

    function startGame() {
        playSfx('https://www.soundjay.com/buttons/sounds/button-3.mp3');
        document.getElementById('splash').style.display = 'none';
        document.getElementById('ui').style.display = 'block';
        playerHand = Array.from({length: 14}, genCard);
        updateScores();
        refreshHand(); 
        startTurn();
    }

    function genCard() { return { suit: suits[Math.floor(Math.random()*4)], val: vals[Math.floor(Math.random()*13)], id: Math.random() }; }

    function refreshHand() {
        const container = document.getElementById('hand');
        container.innerHTML = '';
        const groups = detectGroups();

        playerHand.forEach((c, i) => {
            const cardEl = document.createElement('div');
            const stripColor = groups[c.val] || '';
            cardEl.className = `card ${c.suit==='â™¥'||c.suit==='â™¦'?'red':''}`;
            cardEl.style.zIndex = i;

            cardEl.draggable = true;
            cardEl.innerHTML = `
                <div class="card-strip ${stripColor}"></div>
                <div style="font-weight:900; font-size:1.1rem">${c.val}</div>
                <div style="font-size:2.5rem; text-align:center; line-height:1; margin-top:-5px">${c.suit}</div>
                <div style="text-align:left; font-weight:900">${c.val}</div>
            `;
            
            // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø·ÙˆØ±
            cardEl.addEventListener('dragstart', () => { draggedIdx = i; cardEl.classList.add('dragging'); });
            cardEl.addEventListener('dragend', () => { draggedIdx = null; cardEl.classList.remove('dragging'); refreshHand(); });
            cardEl.addEventListener('dragover', (e) => {
                e.preventDefault();
                if (draggedIdx !== null && draggedIdx !== i) {
                    const temp = playerHand[draggedIdx];
                    playerHand.splice(draggedIdx, 1);
                    playerHand.splice(i, 0, temp);
                    draggedIdx = i;
                    refreshHand(); 
                }
            });

            cardEl.onclick = () => { if(state === "DISCARD" && turn === 0) doDiscard(i); };
            container.appendChild(cardEl);
        });
    }

    function detectGroups() {
        let counts = {}; playerHand.forEach(c => counts[c.val] = (counts[c.val] || 0) + 1);
        let groups = {}, colors = ['strip-blue', 'strip-purple', 'strip-orange'], cIdx = 0;
        Object.keys(counts).forEach(v => { if(counts[v] >= 3) groups[v] = colors[cIdx++ % 3]; });
        return groups;
    }

    function startTurn() {
        state = "DRAW";
        document.querySelectorAll('.profile').forEach(p => p.classList.remove('active-turn'));
        const activeP = document.getElementById(`prof-${turn}`);
        activeP.classList.add('active-turn');
        
        if(turn === 0) {
            setStatus("Ø¯ÙˆØ±Ùƒ: Ø§Ø³Ø­Ø¨ ÙˆØ±Ù‚Ø© Ù…Ù† Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø£Ùˆ Ø§Ù„Ø²Ø¨Ø§Ù„Ø©");
            playSfx('https://www.soundjay.com/buttons/sounds/button-50.mp3');
        } else {
            setStatus(`Ø§Ù„Ø¨ÙˆØª ${activeP.querySelector('.p-name').innerText} ÙŠÙÙƒØ±...`);
            runBot();
        }
    }

    function processAction(type) {
        if(turn !== 0 || state !== "DRAW") return;
        if(type === 'draw') {
            playerHand.push(genCard());
            playSfx('https://www.soundjay.com/misc/sounds/page-flip-01a.mp3');
        } else if(type === 'pick' && discardPile.length > 0) {
            playerHand.push(discardPile.pop());
            playSfx('https://www.soundjay.com/misc/sounds/page-flip-01a.mp3');
        } else return;
        
        state = "DISCARD"; refreshHand(); renderDiscard();
        setStatus("Ø§Ø±Ù…ÙŠ ÙˆØ±Ù‚Ø© ØºÙŠØ± Ù„Ø§Ø²Ù…Ø© Ù„Ø¥Ù†Ù‡Ø§Ø¡ Ø¯ÙˆØ±Ùƒ");
    }

    function doDiscard(i) {
        discardPile.push(playerHand.splice(i, 1)[0]);
        playSfx('https://www.soundjay.com/buttons/sounds/button-10.mp3');
        refreshHand(); renderDiscard();
        turn = (turn + 1) % 4; 
        setTimeout(startTurn, 800);
    }

    function renderDiscard() {
        const p = document.getElementById('discard-pile');
        const c = discardPile[discardPile.length-1];
        if(!c) { p.innerHTML = '<span style="opacity:0.3">Ø§Ù„Ø²Ø¨Ø§Ù„Ø©</span>'; return; }
        p.innerHTML = `<div class="card ${c.suit==='â™¥'||c.suit==='â™¦'?'red':''}" style="width:100%; height:100%; margin:0; border:none;">
            <div>${c.val}</div><div style="font-size:2rem; text-align:center">${c.suit}</div>
        </div>`;
    }

    async function runBot() {
        await new Promise(r => setTimeout(r, 2000));
        discardPile.push(genCard()); 
        renderDiscard();
        playSfx('https://www.soundjay.com/buttons/sounds/button-10.mp3');
        turn = (turn + 1) % 4; 
        startTurn();
    }

    function autoOrganize() { 
        playSfx('https://www.soundjay.com/buttons/sounds/button-20.mp3');
        playerHand.sort((a,b) => vals.indexOf(a.val) - vals.indexOf(b.val)); 
        refreshHand(); 
    }

    function updateScores() {
        const list = document.getElementById('leader-list');
        list.innerHTML = '';
        const players = [{n:"Ø£Ù†Øª",s:0},{n:"Ø§Ù„Ø£Ø³Ø·ÙˆØ±Ø©",s:1200},{n:"Ø§Ù„Ù…Ø­ØªØ±Ù",s:850},{n:"Ø§Ù„Ù…Ø®Ø¶Ø±Ù…",s:600}];
        players.forEach(p => {
            list.innerHTML += `<div class="leader-item"><span>${p.n}</span><span style="color:var(--gold)">${p.s}</span></div>`;
        });
    }

    function setStatus(m) { document.getElementById('status').innerText = m; }

    function playSfx(url) {
        const audio = new Audio(url);
        audio.volume = 0.3;
        audio.play().catch(()=>{}); 
    }

    function handleWin() { 
        const groupsFound = Object.keys(detectGroups()).length;
        if(groupsFound >= 3) {
            playSfx('https://www.soundjay.com/human/sounds/applause-01.mp3');
            document.getElementById('prof-0').classList.add('winner-glow');
            alert("ÙƒÙÙˆÙˆÙˆ! ÙØ²Øª Ø¨Ø§Ù„Ù‡Ù†Ø¯!");
        } else {
            alert("Ù„Ø³Ù‡ Ø¨Ø¯Ø±ÙŠ! ØªØ­ØªØ§Ø¬ 3 Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ù…ÙƒØªÙ…Ù„Ø© (Ø£Ø·Ø±Ø§Ù Ù…Ù„ÙˆÙ†Ø©)"); 
        }
    }
</script>
</body>
</html>